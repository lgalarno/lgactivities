from django.test import TestCase
from django.contrib.auth.models import User

from .models import Activity, Map, Segment, SegmentEffort

# Create your tests here.


class ActivitiesTest(TestCase):

    def setUp(self):
        u = User.objects.create(username="lgalarneau")
        u.save()

    def test_single_activity(self):
        activities = [{'resource_state': 2, 'athlete': {'id': 1490709, 'resource_state': 1}, 'name': 'Jog30m12-12-15', 'distance': 7941.1, 'moving_time': 2690, 'elapsed_time': 2735, 'total_elevation_gain': 0.0, 'type': 'Run', 'workout_type': None, 'id': 455862320, 'external_id': 'Jog30m-2015-12-12.gpx', 'upload_id': 506846448, 'start_date': '2015-12-12T19:46:17Z', 'start_date_local': '2015-12-12T14:46:17Z', 'timezone': '(GMT-05:00) America/Montreal', 'utc_offset': -18000.0, 'start_latlng': [45.55, -73.91], 'end_latlng': [45.55, -73.91], 'location_city': 'Deux Montagnes', 'location_state': 'QC', 'location_country': 'Canada', 'start_latitude': 45.55, 'start_longitude': -73.91, 'achievement_count': 0, 'kudos_count': 0, 'comment_count': 0, 'athlete_count': 1, 'photo_count': 0, 'map': {'id': 'a455862320', 'summary_polyline': 'ab_uGb{bbMu@mEpOgDz@sF}KzB_@qByBq@OoKyIxD`EjPtAWj@aDtDp@FeByCoBI}JgFlAaCtD~DnMbBKV{CpE_@wCgCSgKmFtAuBfDnE`NvAWJqC`FQ}CiDKqJmEx@}CzDdEvMzAKLqCdFE}CyDImJeEp@cDbDlDdNrBBn@cD`Ed@W}BeCeAGgJgAWeH~E`ElN~AIl@cDfEX]yBeCoAn@aEdElInIaA_B|D_OdDU~D~@t@UuA', 'resource_state': 2}, 'trainer': False, 'commute': False, 'manual': False, 'private': False, 'visibility': 'everyone', 'flagged': False, 'gear_id': 'g769689', 'from_accepted_tag': False, 'upload_id_str': '506846448', 'average_speed': 2.952, 'max_speed': 5.0, 'has_heartrate': False, 'heartrate_opt_out': False, 'display_hide_heartrate_option': False, 'elev_high': 37.0, 'elev_low': 30.6, 'pr_count': 0, 'total_photo_count': 0, 'has_kudoed': False, 'suffer_score': None}, {'resource_state': 2, 'athlete': {'id': 1490709, 'resource_state': 1}, 'name': 'Jog Hilly 10-12-15', 'distance': 6303.7, 'moving_time': 2325, 'elapsed_time': 2340, 'total_elevation_gain': 0.0, 'type': 'Run', 'workout_type': None, 'id': 455862319, 'external_id': 'Jog_Hilly-2015-12-10.gpx', 'upload_id': 506846447, 'start_date': '2015-12-11T02:55:51Z', 'start_date_local': '2015-12-10T21:55:51Z', 'timezone': '(GMT-05:00) America/Montreal', 'utc_offset': -18000.0, 'start_latlng': [45.55, -73.91], 'end_latlng': [45.55, -73.91], 'location_city': 'Deux Montagnes', 'location_state': 'QC', 'location_country': 'Canada', 'start_latitude': 45.55, 'start_longitude': -73.91, 'achievement_count': 0, 'kudos_count': 0, 'comment_count': 0, 'athlete_count': 1, 'photo_count': 0, 'map': {'id': 'a455862319', 'summary_polyline': '{b_uGfzbbMY{DnOuD~GuQ\\_InPuVvHzMkGpJwAmDtNcTtB`BcNnTkAl@y@aDdOsTzAhBkNtUo@f@iAkDjOcUzArB_PzVkA_D`GkKeFwG{ObVKnEcKt[yJxC', 'resource_state': 2}, 'trainer': False, 'commute': False, 'manual': False, 'private': False, 'visibility': 'everyone', 'flagged': False, 'gear_id': 'g769689', 'from_accepted_tag': False, 'upload_id_str': '506846447', 'average_speed': 2.711, 'max_speed': 4.9, 'has_heartrate': False, 'heartrate_opt_out': False, 'display_hide_heartrate_option': False, 'elev_high': 39.7, 'elev_low': 34.2, 'pr_count': 0, 'total_photo_count': 0, 'has_kudoed': False, 'suffer_score': None}, {'resource_state': 2, 'athlete': {'id': 1490709, 'resource_state': 1}, 'name': 'Jog30m6-12-15', 'distance': 7590.2, 'moving_time': 2715, 'elapsed_time': 2765, 'total_elevation_gain': 0.0, 'type': 'Run', 'workout_type': None, 'id': 445662066, 'external_id': 'Jog30m-2015-12-6.gpx', 'upload_id': 496401332, 'start_date': '2015-12-06T19:41:45Z', 'start_date_local': '2015-12-06T14:41:45Z', 'timezone': '(GMT-05:00) America/Montreal', 'utc_offset': -18000.0, 'start_latlng': [45.55, -73.91], 'end_latlng': [45.55, -73.91], 'location_city': 'Deux Montagnes', 'location_state': 'QC', 'location_country': 'Canada', 'start_latitude': 45.55, 'start_longitude': -73.91, 'achievement_count': 0, 'kudos_count': 1, 'comment_count': 0, 'athlete_count': 1, 'photo_count': 0, 'map': {'id': 'a445662066', 'summary_polyline': 'qb_uGnybbM[uCjOoDt@eFsKlBc@iCaCaAI}IgEr@eD|DxEnNpAY`@}CjECwCwCEeKiFv@kCbDpE~NtAYb@cD|Dl@AuBoC}A[aKcI`DSjBhEpM`Be@HiCnE`@EcCiC_AOiKyIzCn@zGlDjH|A_EfE\\OuBmCqAAwIsJzC`FhPhAe@FoC~EY_DaDO{JeE`AcDrDvEpNlCeEpCv@xLsCkAzD}NbDXhE', 'resource_state': 2}, 'trainer': False, 'commute': False, 'manual': False, 'private': False, 'visibility': 'everyone', 'flagged': False, 'gear_id': 'g769689', 'from_accepted_tag': False, 'upload_id_str': '496401332', 'average_speed': 2.796, 'max_speed': 5.0, 'has_heartrate': False, 'heartrate_opt_out': False, 'display_hide_heartrate_option': False, 'elev_high': 37.0, 'elev_low': 30.5, 'pr_count': 0, 'total_photo_count': 0, 'has_kudoed': False, 'suffer_score': None}]
        activity = activities[0]
        u = User.objects.get(username="lgalarneau")
        a, created = Activity.objects.get_or_create(id=activity.get('id'), user=u)

        self.assertTrue(created)

        a.name = activity.get('name')
        a.type = activity.get('type')
        a.start_date = activity.get('start_date')
        a.start_date_local = activity.get('start_date_local')
        a.save()

        b, created = Activity.objects.get_or_create(id=activity.get('id'), user=u)

        self.assertFalse(created)
        self.assertEqual(b.name, activity.get('name'))

        activity_detailed = {'resource_state': 3, 'athlete': {'id': 1490709, 'resource_state': 1}, 'name': 'Jog30m6-12-15', 'distance': 7590.2, 'moving_time': 2715, 'elapsed_time': 2765, 'total_elevation_gain': 0.0, 'type': 'Run', 'workout_type': None, 'id': 445662066, 'external_id': 'Jog30m-2015-12-6.gpx', 'upload_id': 496401332, 'start_date': '2015-12-06T19:41:45Z', 'start_date_local': '2015-12-06T14:41:45Z', 'timezone': '(GMT-05:00) America/Montreal', 'utc_offset': -18000.0, 'start_latlng': [45.55, -73.91], 'end_latlng': [45.55, -73.91], 'location_city': 'Deux Montagnes', 'location_state': 'QC', 'location_country': 'Canada', 'start_latitude': 45.55, 'start_longitude': -73.91, 'achievement_count': 0, 'kudos_count': 1, 'comment_count': 0, 'athlete_count': 1, 'photo_count': 0, 'map': {'id': 'a445662066', 'polyline': 'qb_uGnybbM?JGAEECIC]Ia@Ec@CCBSHSb@[h@KLQRIdCUv@i@NQd@O|@Gd@Il@PTIr@kCF{@E]KKy@B]Ji@ZeATQJm@JYMQAMESHSFQNKREMKuAQe@YSU@OEWASGKIIUMs@A]H_@NUJ[Ak@E]Ai@UeAYISDm@`@y@PSNQ?KKULq@v@QH{@`AMVARFd@~@|CRh@R\\l@vB\\|@\\l@\\Ar@WPa@QgABc@\\OVIZBxBx@XWB_@Eo@Gc@UW}AYUQQgAGc@Dc@\\u@G}CGa@]Ia@Fs@R_A^Y?[Do@h@k@j@i@n@E\\Fr@~@lDl@bBVfAn@bBRL`@@r@[Ne@SkANe@VKZIZHhBp@ZCJc@MqAO]UK}A[KWUqACe@JWR[F[MoACsAWUYB}Bt@w@Hm@^eA|@QXId@Fj@XbAr@pC`@z@P|@Nb@^`AVZZFZKVOPQ@k@Ia@?k@PO^KXA|Bt@VELa@Eg@My@YSyAYUQGa@MaA?i@^w@Ae@MaA?}@I]UCeAVsAb@Q?]Hq@j@gAl@SVE^Fj@`AvDVt@PZVhANb@n@zAPLX@p@YR[Cg@Ia@?]PWRIZG^FVHn@Xl@PTW?o@C]Kg@USgB[Oa@WkBL]P[FYMmACiAI_@]EoCz@YCYHeAv@m@j@SZEd@Fj@lAjE`@|@^zA`@dAR^XJZGVMTOF_@Im@Ee@N[XKXGr@NjAh@XDP]?g@Gg@Ma@MQ[Iy@OYKK_@SiA?]b@gAAc@Ic@?kAEc@MSa@Fy@VYLu@TYAeBbAk@b@QZ?n@Fb@v@rC\\`ANXJXVlAl@~AVTZ?RITOXYCg@Ic@Bc@TS`@M^DpBp@b@QZm@b@MbAL`@A|Ae@b@SlAa@LCPLAVCT[d@M\\EXUn@ODWAQEW?e@FOHSBc@Ls@TOJe@HOJMFQFmAP{@`@YDSRC`@TxABr@DTFPHHHKAIIICWC[BQ?DCH?XHN', 'resource_state': 3, 'summary_polyline': 'qb_uGnybbM[uCjOoDt@eFsKlBc@iCaCaAI}IgEr@eD|DxEnNpAY`@}CjECwCwCEeKiFv@kCbDpE~NtAYb@cD|Dl@AuBoC}A[aKcI`DSjBhEpM`Be@HiCnE`@EcCiC_AOiKyIzCn@zGlDjH|A_EfE\\OuBmCqAAwIsJzC`FhPhAe@FoC~EY_DaDO{JeE`AcDrDvEpNlCeEpCv@xLsCkAzD}NbDXhE'}, 'trainer': False, 'commute': False, 'manual': False, 'private': False, 'visibility': 'everyone', 'flagged': False, 'gear_id': 'g769689', 'from_accepted_tag': False, 'upload_id_str': '496401332', 'average_speed': 2.796, 'max_speed': 5.0, 'has_heartrate': False, 'heartrate_opt_out': False, 'display_hide_heartrate_option': False, 'elev_high': 37.0, 'elev_low': 30.5, 'pr_count': 0, 'total_photo_count': 0, 'has_kudoed': False, 'suffer_score': None, 'description': '', 'calories': 656.4, 'perceived_exertion': None, 'prefer_perceived_exertion': None, 'segment_efforts': [{'id': 10716161380, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 345, 'moving_time': 345, 'start_date': '2015-12-06T19:50:15Z', 'start_date_local': '2015-12-06T14:50:15Z', 'distance': 1000.9, 'start_index': 102, 'end_index': 171, 'segment': {'id': 4996607, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity_type': 'Run', 'distance': 1000.9, 'average_grade': 0.0, 'maximum_grade': 2.5, 'elevation_high': 35.3, 'elevation_low': 30.8, 'start_latlng': [45.549054, -73.9068], 'end_latlng': [45.548997, -73.906755], 'elevation_profile': None, 'start_latitude': 45.549054, 'start_longitude': -73.9068, 'end_latitude': 45.548997, 'end_longitude': -73.906755, 'climb_category': 0, 'city': 'Deux Montagnes', 'state': 'QC', 'country': 'Canada', 'private': False, 'hazardous': False, 'starred': False}, 'pr_rank': None, 'achievements': [], 'kom_rank': None, 'hidden': False}, {'id': 10716161401, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 320, 'moving_time': 320, 'start_date': '2015-12-06T19:56:00Z', 'start_date_local': '2015-12-06T14:56:00Z', 'distance': 1000.9, 'start_index': 171, 'end_index': 235, 'segment': {'id': 4996607, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity_type': 'Run', 'distance': 1000.9, 'average_grade': 0.0, 'maximum_grade': 2.5, 'elevation_high': 35.3, 'elevation_low': 30.8, 'start_latlng': [45.549054, -73.9068], 'end_latlng': [45.548997, -73.906755], 'elevation_profile': None, 'start_latitude': 45.549054, 'start_longitude': -73.9068, 'end_latitude': 45.548997, 'end_longitude': -73.906755, 'climb_category': 0, 'city': 'Deux Montagnes', 'state': 'QC', 'country': 'Canada', 'private': False, 'hazardous': False, 'starred': False}, 'pr_rank': None, 'achievements': [], 'kom_rank': None, 'hidden': False}, {'id': 10716161413, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 330, 'moving_time': 330, 'start_date': '2015-12-06T20:01:20Z', 'start_date_local': '2015-12-06T15:01:20Z', 'distance': 1000.9, 'start_index': 235, 'end_index': 301, 'segment': {'id': 4996607, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity_type': 'Run', 'distance': 1000.9, 'average_grade': 0.0, 'maximum_grade': 2.5, 'elevation_high': 35.3, 'elevation_low': 30.8, 'start_latlng': [45.549054, -73.9068], 'end_latlng': [45.548997, -73.906755], 'elevation_profile': None, 'start_latitude': 45.549054, 'start_longitude': -73.9068, 'end_latitude': 45.548997, 'end_longitude': -73.906755, 'climb_category': 0, 'city': 'Deux Montagnes', 'state': 'QC', 'country': 'Canada', 'private': False, 'hazardous': False, 'starred': False}, 'pr_rank': None, 'achievements': [], 'kom_rank': None, 'hidden': False}, {'id': 10716161427, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 335, 'moving_time': 335, 'start_date': '2015-12-06T20:06:55Z', 'start_date_local': '2015-12-06T15:06:55Z', 'distance': 1000.9, 'start_index': 302, 'end_index': 369, 'segment': {'id': 4996607, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity_type': 'Run', 'distance': 1000.9, 'average_grade': 0.0, 'maximum_grade': 2.5, 'elevation_high': 35.3, 'elevation_low': 30.8, 'start_latlng': [45.549054, -73.9068], 'end_latlng': [45.548997, -73.906755], 'elevation_profile': None, 'start_latitude': 45.549054, 'start_longitude': -73.9068, 'end_latitude': 45.548997, 'end_longitude': -73.906755, 'climb_category': 0, 'city': 'Deux Montagnes', 'state': 'QC', 'country': 'Canada', 'private': False, 'hazardous': False, 'starred': False}, 'pr_rank': None, 'achievements': [], 'kom_rank': None, 'hidden': False}, {'id': 10716161446, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 330, 'moving_time': 330, 'start_date': '2015-12-06T20:12:35Z', 'start_date_local': '2015-12-06T15:12:35Z', 'distance': 1000.9, 'start_index': 370, 'end_index': 436, 'segment': {'id': 4996607, 'resource_state': 2, 'name': 'Poly DM 1km', 'activity_type': 'Run', 'distance': 1000.9, 'average_grade': 0.0, 'maximum_grade': 2.5, 'elevation_high': 35.3, 'elevation_low': 30.8, 'start_latlng': [45.549054, -73.9068], 'end_latlng': [45.548997, -73.906755], 'elevation_profile': None, 'start_latitude': 45.549054, 'start_longitude': -73.9068, 'end_latitude': 45.548997, 'end_longitude': -73.906755, 'climb_category': 0, 'city': 'Deux Montagnes', 'state': 'QC', 'country': 'Canada', 'private': False, 'hazardous': False, 'starred': False}, 'pr_rank': None, 'achievements': [], 'kom_rank': None, 'hidden': False}], 'splits_metric': [{'distance': 1012.9, 'elapsed_time': 470, 'elevation_difference': -4.3, 'moving_time': 445, 'split': 1, 'average_speed': 2.28, 'average_grade_adjusted_speed': 2.24, 'pace_zone': 0}, {'distance': 991.4, 'elapsed_time': 350, 'elevation_difference': 0.3, 'moving_time': 350, 'split': 2, 'average_speed': 2.83, 'average_grade_adjusted_speed': 2.84, 'pace_zone': 0}, {'distance': 1006.0, 'elapsed_time': 320, 'elevation_difference': 0.0, 'moving_time': 320, 'split': 3, 'average_speed': 3.14, 'average_grade_adjusted_speed': 3.15, 'pace_zone': 0}, {'distance': 991.7, 'elapsed_time': 325, 'elevation_difference': 0.1, 'moving_time': 325, 'split': 4, 'average_speed': 3.05, 'average_grade_adjusted_speed': 3.06, 'pace_zone': 0}, {'distance': 1010.4, 'elapsed_time': 340, 'elevation_difference': 0.1, 'moving_time': 340, 'split': 5, 'average_speed': 2.97, 'average_grade_adjusted_speed': 2.98, 'pace_zone': 0}, {'distance': 990.6, 'elapsed_time': 325, 'elevation_difference': 0.4, 'moving_time': 325, 'split': 6, 'average_speed': 3.05, 'average_grade_adjusted_speed': 3.06, 'pace_zone': 0}, {'distance': 1005.8, 'elapsed_time': 320, 'elevation_difference': 3.8, 'moving_time': 320, 'split': 7, 'average_speed': 3.14, 'average_grade_adjusted_speed': 3.2, 'pace_zone': 0}, {'distance': 581.4, 'elapsed_time': 315, 'elevation_difference': -0.5, 'moving_time': 290, 'split': 8, 'average_speed': 2.0, 'average_grade_adjusted_speed': 2.0, 'pace_zone': 0}], 'splits_standard': [{'distance': 1622.9, 'elapsed_time': 695, 'elevation_difference': -2.2, 'moving_time': 670, 'split': 1, 'average_speed': 2.42, 'average_grade_adjusted_speed': 2.41, 'pace_zone': 0}, {'distance': 1595.8, 'elapsed_time': 510, 'elevation_difference': -3.5, 'moving_time': 510, 'split': 2, 'average_speed': 3.13, 'average_grade_adjusted_speed': 3.1, 'pace_zone': 0}, {'distance': 1618.3, 'elapsed_time': 540, 'elevation_difference': 3.6, 'moving_time': 540, 'split': 3, 'average_speed': 3.0, 'average_grade_adjusted_speed': 3.03, 'pace_zone': 0}, {'distance': 1610.3, 'elapsed_time': 530, 'elevation_difference': -0.6, 'moving_time': 530, 'split': 4, 'average_speed': 3.04, 'average_grade_adjusted_speed': 3.04, 'pace_zone': 0}, {'distance': 1142.9, 'elapsed_time': 490, 'elevation_difference': 2.6, 'moving_time': 465, 'split': 5, 'average_speed': 2.46, 'average_grade_adjusted_speed': 2.48, 'pace_zone': 0}], 'laps': [{'id': 1366721753, 'resource_state': 2, 'name': 'Lap 1', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 2765, 'moving_time': 2765, 'start_date': '2015-12-06T19:41:45Z', 'start_date_local': '2015-12-06T14:41:45Z', 'distance': 7590.2, 'start_index': 0, 'end_index': 553, 'total_elevation_gain': 0.0, 'average_speed': 2.75, 'max_speed': 5.0, 'lap_index': 1, 'split': 1, 'pace_zone': 0}], 'best_efforts': [{'id': 1136755558, 'resource_state': 2, 'name': '400m', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 114, 'moving_time': 115, 'start_date': '2015-12-06T20:19:40Z', 'start_date_local': '2015-12-06T15:19:40Z', 'distance': 400, 'start_index': 455, 'end_index': 478, 'pr_rank': None, 'achievements': []}, {'id': 1136755559, 'resource_state': 2, 'name': '1/2 mile', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 244, 'moving_time': 245, 'start_date': '2015-12-06T20:17:35Z', 'start_date_local': '2015-12-06T15:17:35Z', 'distance': 805, 'start_index': 430, 'end_index': 479, 'pr_rank': None, 'achievements': []}, {'id': 1136755560, 'resource_state': 2, 'name': '1k', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 309, 'moving_time': 310, 'start_date': '2015-12-06T20:16:25Z', 'start_date_local': '2015-12-06T15:16:25Z', 'distance': 1000, 'start_index': 416, 'end_index': 478, 'pr_rank': None, 'achievements': []}, {'id': 1136755561, 'resource_state': 2, 'name': '1 mile', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 509, 'moving_time': 510, 'start_date': '2015-12-06T20:13:15Z', 'start_date_local': '2015-12-06T15:13:15Z', 'distance': 1609, 'start_index': 378, 'end_index': 480, 'pr_rank': None, 'achievements': []}, {'id': 1136755562, 'resource_state': 2, 'name': '2 mile', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 1043, 'moving_time': 1045, 'start_date': '2015-12-06T19:51:30Z', 'start_date_local': '2015-12-06T14:51:30Z', 'distance': 3219, 'start_index': 117, 'end_index': 326, 'pr_rank': None, 'achievements': []}, {'id': 1136755563, 'resource_state': 2, 'name': '5k', 'activity': {'id': 445662066, 'resource_state': 1}, 'athlete': {'id': 1490709, 'resource_state': 1}, 'elapsed_time': 1619, 'moving_time': 1620, 'start_date': '2015-12-06T19:54:40Z', 'start_date_local': '2015-12-06T14:54:40Z', 'distance': 5000, 'start_index': 155, 'end_index': 479, 'pr_rank': None, 'achievements': []}], 'gear': {'id': 'g769689', 'primary': False, 'name': 'New Balance MR00 v2', 'resource_state': 2, 'retired': False, 'distance': 1569690}, 'photos': {'primary': None, 'count': 0}, 'stats_visibility': [{'type': 'heart_rate', 'visibility': 'everyone'}, {'type': 'pace', 'visibility': 'everyone'}, {'type': 'power', 'visibility': 'everyone'}, {'type': 'speed', 'visibility': 'everyone'}, {'type': 'calories', 'visibility': 'everyone'}], 'hide_from_home': False, 'device_name': 'GPX', 'embed_token': 'f8a3b7b0ab4bf138164989470ecd2d623f24f4f4', 'private_note': None, 'similar_activities': {'effort_count': 101, 'average_speed': 2.731593191830351, 'min_average_speed': 2.4162702853003273, 'mid_average_speed': 2.662558134530061, 'max_average_speed': 2.964752154860468, 'pr_rank': None, 'frequency_milestone': None, 'trend': {'speeds': [2.7974188341937447, 2.8036053951021556, 2.821206764519858, 2.8566304969581515, 2.8275569806655034], 'current_activity_index': 2, 'min_speed': 2.4162702853003273, 'mid_speed': 2.662558134530061, 'max_speed': 2.964752154860468, 'direction': 0}, 'resource_state': 2}, 'available_zones': ['pace']}
        m, created = Map.objects.get_or_create(activity=a)
        m.polyline = activity_detailed.get('map').get('polyline')
        m.save()
        if "segment_efforts" in activity_detailed:
            segment_efforts = activity_detailed.get("segment_efforts")
            for se in segment_efforts:
                print(se)
                segment, created = Segment.objects.get_or_create(
                    id=se.get('segment').get('id')
                )
                segment.name = se.get('segment').get('name')
                segment.save()
                # elements required for 'set_pr_rank' in models of SegmentEffort
                obj, created = SegmentEffort.objects.get_or_create(
                    id=se.get('id'),
                    activity=a,
                    segment=segment,
                    elapsed_time=se.get('elapsed_time')
                )
                obj.start_date = se.get('start_date')
                obj.start_date_local = se.get('start_date_local')
                obj.distance = se.get('distance')
                obj.save()

        se, created = SegmentEffort.objects.get_or_create(id=10716161380)

        self.assertFalse(created)
        self.assertEqual(se.segment.name, 'Poly DM 1km')
